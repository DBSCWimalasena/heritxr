<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>HeritXR Visitor Survey</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 700px;
      margin: auto;
      padding: 20px;
    }
    h2 {
      color: #2c3e50;
    }
    p {
      margin-top: 20px;
      font-weight: bold;
    }
    label {
      display: block;
      margin: 6px 0;
      font-weight: normal;
    }
    button {
      margin-top: 30px;
      padding: 12px;
      font-size: 16px;
      width: 100%;
    }
  </style>
</head>
<body>

<!-- DYNAMIC HEADER -->
<h2 id="welcomeText">Welcome</h2>
<p id="timeText"></p>

<form id="surveyForm">

  <!-- TOKEN -->
  <input type="hidden" id="token" name="token">

  <!-- 1 AGE GROUP -->
  <p>1. What is your age group?</p>
  <label><input type="radio" name="age_group" value="Under 12" required> Under 12</label>
  <label><input type="radio" name="age_group" value="13-18"> 13–18</label>
  <label><input type="radio" name="age_group" value="19-25"> 19–25</label>
  <label><input type="radio" name="age_group" value="26-35"> 26–35</label>
  <label><input type="radio" name="age_group" value="36-50"> 36–50</label>
  <label><input type="radio" name="age_group" value="Above 50"> Above 50</label>

  <!-- 2 VISIT PURPOSE -->
  <p>2. Which best describes you today?</p>
  <label><input type="radio" name="visit_purpose" value="Enjoy Experience" required> Enjoy experience</label>
  <label><input type="radio" name="visit_purpose" value="Assignment/Study"> Assignment / Study</label>
  <label><input type="radio" name="visit_purpose" value="Deep History"> Deep historical facts</label>
  <label><input type="radio" name="visit_purpose" value="Architectural Data"> Architectural data</label>
  <label><input type="radio" name="visit_purpose" value="Religious Connection"> Religious significance</label>

  <!-- 3 INTEREST LEVELS -->
  <p>3. What aspects interest you the most?</p>

  Architecture:
  <label><input type="radio" name="interest_architecture" value="Low" required> Low</label>
  <label><input type="radio" name="interest_architecture" value="Medium"> Medium</label>
  <label><input type="radio" name="interest_architecture" value="High"> High</label>

  History & Kings:
  <label><input type="radio" name="interest_history" value="Low" required> Low</label>
  <label><input type="radio" name="interest_history" value="Medium"> Medium</label>
  <label><input type="radio" name="interest_history" value="High"> High</label>

  Buddhism & Spirituality:
  <label><input type="radio" name="interest_spirituality" value="Low" required> Low</label>
  <label><input type="radio" name="interest_spirituality" value="Medium"> Medium</label>
  <label><input type="radio" name="interest_spirituality" value="High"> High</label>

  Art:
  <label><input type="radio" name="interest_art" value="Low" required> Low</label>
  <label><input type="radio" name="interest_art" value="Medium"> Medium</label>
  <label><input type="radio" name="interest_art" value="High"> High</label>

  <!-- 4 VISITED BEFORE -->
  <p>4. Have you visited Thuparamaya before?</p>
  <label><input type="radio" name="visited_before" value="1" required> Yes</label>
  <label><input type="radio" name="visited_before" value="0"> No</label>

  <!-- 5 LANGUAGE LEVEL -->
  <p>5. Preferred language level?</p>
  <label><input type="radio" name="language_level" value="Simple" required> Simple</label>
  <label><input type="radio" name="language_level" value="Moderate"> Moderate</label>
  <label><input type="radio" name="language_level" value="Advanced"> Advanced</label>

  <!-- 6 EXPLANATION TYPE -->
  <p>6. Explanation style?</p>
  <label><input type="radio" name="explanation_type" value="Long Detailed" required> Long detailed</label>
  <label><input type="radio" name="explanation_type" value="Balanced"> Balanced</label>
  <label><input type="radio" name="explanation_type" value="Short Highlights"> Short highlights</label>

  

  <!-- 8 TIMELINE -->
  <p>7. Timeline preference?</p>
  <label><input type="radio" name="timeline_direction" value="Past to Present" required> Past → Present</label>
  <label><input type="radio" name="timeline_direction" value="Present to Past"> Present → Past</label>

  <!-- 9 TIME OF DAY -->
  <p>8. Preferred time of day?</p>
  <label><input type="radio" name="preferred_time" value="Day" required> Day</label>
  <label><input type="radio" name="preferred_time" value="Night"> Night</label>
  <label><input type="radio" name="preferred_time" value="Both"> Both</label>

  <!-- 10 BUDDHIST HISTORY KNOWLEDGE -->
  <p>9. Familiar with Buddhist history?</p>
  <label><input type="radio" name="buddhist_history_knowledge" value="1" required> Yes</label>
  <label><input type="radio" name="buddhist_history_knowledge" value="0"> No</label>

  <button type="submit">Submit Survey</button>
</form>

<script>
  // READ TOKEN
  const params = new URLSearchParams(window.location.search);
  const token = params.get('token');

  if (!token) {
    alert('Invalid QR');
  } else {
    document.getElementById('token').value = token;

    // FETCH NAME & TIME FROM BACKEND
    fetch(`/api/visitor/temp/${token}`)
      .then(res => res.json())
      .then(data => {
        document.getElementById('welcomeText').innerText =
          `Welcome ${data.name}`;
        document.getElementById('timeText').innerText =
          `Time budget: ${data.duration} minutes`;
      })
      .catch(() => {
        alert('QR expired or invalid');
      });
  }

  // SUBMIT FORM
  document.getElementById('surveyForm').addEventListener('submit', async (e) => {
    e.preventDefault();

    const formData = new FormData(e.target);
    const payload = Object.fromEntries(formData.entries());

    const res = await fetch('/api/visitor/submit', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    });

    const result = await res.json();
    alert(result.message);

    if (res.ok) {
      document.body.innerHTML =
        '<h2>Thank you! Your response has been recorded.</h2>';
    }
  });
</script>

</body>
</html>
